<img width="935" height="488" alt="image" src="https://github.com/user-attachments/assets/0cfdc467-302d-4bce-a061-2f0337645be9" />

### SeImpersonatePrivilege là một đặc quyền Windows thường được gán cho các tài khoản dịch vụ. Nó cho phép một tiến trình mạo danh người dùng hoặc tài khoản khác và hành động thay mặt họ. Trên thực tế, điều này có nghĩa là người dùng hoặc dịch vụ nắm giữ đặc quyền này có thể gọi hàm API Windows CreateProcessAsUser(), cho phép một tiến trình khởi chạy một tiến trình khác trong một ngữ cảnh bảo mật khác.

<img width="917" height="648" alt="image" src="https://github.com/user-attachments/assets/7f550c23-740d-452d-a6d8-83e544cfb9a7" />

### whoami /priv → kiểm tra các quyền đặc biệt của tài khoản hiện tại. Nếu thấy SeImpersonatePrivilege bật (Enabled/Habilitada), đây là một dấu hiệu nguy hiểm trong an ninh hệ thống, vì nó có thể bị khai thác để chiếm toàn bộ hệ thống.

<img width="921" height="660" alt="image" src="https://github.com/user-attachments/assets/a7fc0262-330c-4e48-911e-b893741cfd37" />

<img width="649" height="887" alt="image" src="https://github.com/user-attachments/assets/a006a97d-695c-40ff-8ba5-2b5d25905522" />

<img width="579" height="744" alt="image" src="https://github.com/user-attachments/assets/c2696812-8e62-462e-8c53-0310f166a09c" />

<img width="622" height="638" alt="image" src="https://github.com/user-attachments/assets/d8618a4b-73a6-4804-bab7-0ff0506f68c5" />

### PrintSpoofer mở một "cửa" giao tiếp nội bộ (named pipe / RPC endpoint) làm mồi, khiến một dịch vụ chạy với quyền cao kết nối vào đó — khi dịch vụ kết nối, công cụ tận dụng kết nối đó để lấy token của dịch vụ và mạo danh token đó, từ đó khởi chạy tiến trình với quyền cao (ví dụ: SYSTEM).

### tóm lại là khi tiến trình có found privilege: SeImpersonatePrivilege nghĩa là quyền cho phép tiến trình thực hiện mạo danh. Quyền này nghĩa là tiến trình có thể nhận token của tiến trình khác để hành động thay mặt tài khoản đó. Lúc này sẽ sử dụng PrintSpoofer để tạo ra 1 mồi nhử để dụ dỗ tiến trình có quyền cao kết nối tới. Khi tiến trình có quyền cao kết nối tới thì công cụ sẽ tận dụng kết nối để lấy token mạo danh tiến trình có quyền cao. Lúc này dưới tác dụng của quyền SeImpersonatePrivilege thì tiến trình hoàn toàn có quyền mạo danh. Sau khi mạo danh thành công, công cụ gọi API để tạo một tiến trình mới với token của tài khoản có quyền cao (thường là NT AuTHORITY\SYSTEM). Nhờ vậy mà tiến trình con chạy với quyền SYSTEM> Điều này chứng tỏ leo thang đặc quyền thành công lên tài khoản SYSTEM. ĐÚng không  

<img width="571" height="739" alt="image" src="https://github.com/user-attachments/assets/f96ad3b7-93da-4ba2-803a-9f912f54b595" />

<img width="673" height="615" alt="image" src="https://github.com/user-attachments/assets/f9251262-67d8-447c-8af8-fe3b355e5a38" />

<img width="583" height="913" alt="image" src="https://github.com/user-attachments/assets/0a97529b-59bb-439c-861a-bb73e03f6b00" />

### SharpEfsPotato làm việc theo cùng một ý tưởng cơ bản như PrintSpoofer/JuicyPotato: nó tạo một endpoint IPC (named pipe/RPC) làm mồi, dùng một giao diện dịch vụ (ở đây là EfsRpc / EFS-related RPC) để khiến dịch vụ quyền cao kết nối vào mồi, rồi impersonate token của dịch vụ đó và gọi API để khởi tiến trình dưới token (thường là NT AUTHORITY\SYSTEM) — kết quả là leo thang quyền thành công.

<img width="585" height="601" alt="image" src="https://github.com/user-attachments/assets/a27197de-3df3-47f3-9de8-cd636a27bf78" />

<img width="573" height="427" alt="image" src="https://github.com/user-attachments/assets/4f4d3f18-bfee-4378-b4f0-bf24bcbe9c35" />

### GodPotato là một công cụ/biến thể để leo thang đặc quyền cục bộ trên Windows — nó thực hiện cùng ý tưởng chung như JuicyPotato/PrintSpoofer/SharpEfsPotato: lợi dụng khả năng mạo danh (impersonation) và một giao diện dịch vụ/RPC/COM dễ bị lừa để chiếm token của tiến trình quyền cao và spawn tiến trình dưới NT AUTHORITY\SYSTEM. Phiên bản “NET4”/“.NET” của GodPotato là một implementation viết cho .NET runtime (hay phụ thuộc .NET), thường được dùng trong PoC/lab.

<img width="665" height="773" alt="image" src="https://github.com/user-attachments/assets/570ac675-5e75-41d2-8ff8-3c905b4674ec" />

<img width="865" height="826" alt="image" src="https://github.com/user-attachments/assets/20de72c6-890d-409e-bb97-d51b4c328cb3" />

### RoguePotato là một biến thể trong “Potato family” — tức các PoC/tool dùng để leo thang đặc quyền cục bộ trên Windows bằng cách tận dụng khả năng mạo danh/duplicate token và một giao diện dịch vụ dễ bị lợi dụng. Về bản chất nó cùng ý tưởng với JuicyPotato / PrintSpoofer / SharpEfsPotato, nhưng mỗi bản (và mỗi fork) khác nhau ở vector, cách hiện thực và chi tiết kỹ thuật. Mình sẽ giải thích rõ hơn, ở mức khái quát và an toàn (không cung cấp hướng dẫn khai thác).

<img width="595" height="652" alt="image" src="https://github.com/user-attachments/assets/74ef3b26-8a7c-472c-abef-9930c45ec3a8" />

<img width="885" height="524" alt="image" src="https://github.com/user-attachments/assets/509f5f9b-d06e-45e5-a70b-6a78f046a669" />

### SweetPotato (thường viết là SweetPotato) là một công cụ/PoC trong họ “Potato” dùng để leo thang đặc quyền cục bộ trên Windows bằng cách tận dụng khả năng impersonation/duplicate token và một service/RPC/COM endpoint dễ bị lợi dụng. Về bản chất nó cùng ý tưởng với JuicyPotato / PrintSpoofer / SharpEfsPotato / RoguePotato — khác nhau ở vector, cách triển khai và một số tweak kỹ thuật. Mình sẽ giải thích ngắn, rõ ràng, không đưa hướng dẫn khai thác.

<img width="601" height="806" alt="image" src="https://github.com/user-attachments/assets/2563fbe6-ba58-4e23-b44f-92cfd97d0fff" />

## => Tóm lại: PrintSpoofer, SharpEfsPotato, GodPotato, RoguePotato, SweetPotato (và các biến thể “Potato”) đều là công cụ PoC/red-team để leo thang đặc quyền cục bộ bằng cách mở một mồi (named pipe / RPC endpoint) để dụ một dịch vụ/chương trình chạy với quyền cao kết nối vào; khi dịch vụ đó kết nối, công cụ impersonate / duplicate token của dịch vụ và rồi spawn một tiến trình mới dưới token đó (ví dụ NT AUTHORITY\SYSTEM).




